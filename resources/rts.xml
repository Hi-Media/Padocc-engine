<?xml version="1.0" encoding="UTF-8"?>
<project name="rts">
    <env name="fuel_batch_prod" mailto="devaa@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/fuel_rts_batch_prod">
        <property name="servers" value="${SERVER_SCHED_DC_EU1}"/>
        <property name="env_file" value="env_prod.php"/>
        <call target="content_fuel"/>
    </env>
    <target name="content_fuel">
        <externalproperty name="ref" description="Branch or tag to deploy"/>
        <gitexport repository="git@git.twenga.com:rts/batch.git" ref="${REF}" destdir="${TMPDIR}"/>
        <mkdir destdir="${TMPDIR}/fuel/app/cache" mode="777"/>
        <mkdir destdir="${TMPDIR}/fuel/app/tmp" mode="777"/>
        <rename src="${TMPDIR}/fuel/app/env/${env_file}" dest="${TMPDIR}/fuel/app/env/env.php"/>
        <buildlanguage project="rts" destdir="${TMPDIR}/fuel/languages"/>
        <sync src="${TMPDIR}/" destdir="${SERVERS}:${BASEDIR}"/>
    </target>
    <env name="batch_prod" mailto="devaa@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/batch_rts_prod">
        <property name="servers" value="${SERVER_EXTRANET_QA}"/>
        <property name="config_file" value="config_prod_batch.php"/>
        <property name="commondir" value="/home/httpd/twenga-common"/>
        <call target="content"/>
    </env>
    <env name="batch_qa" mailto="devaa@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/batch_rts_qa">
        <property name="servers" value="${SERVER_EXTRANET_QA}"/>
        <property name="config_file" value="config_qa_batch.php"/>
        <property name="commondir" value="/home/httpd/twenga-common"/>
        <call target="content"/>
    </env>
    <env name="integration" mailto="devaa@twenga.com, qateam@twenga.com, devrts@twenga.com" loadtwengaservers="true" basedir="/home/projects/extranet.twenga.com">
        <property name="servers" value="continuous-02.dev"/>
        <property name="commondir" value="${BASEDIR}/twenga-common"/>
        <property name="config_file" value="config_jenkins.php"/>
        <call target="content"/>
    </env>
    <env name="qa" mailto="devaa@twenga.com, qateam@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/extranet.twenga.com">
        <property name="servers" value="${SERVER_EXTRANET_QA}"/>
        <property name="commondir" value="/home/httpd/twenga-common"/>
        <property name="config_file" value="config_qa.php"/>
        <call target="content"/>
    </env>
    <env name="prod46" mailto="devaa@twenga.com, qateam@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/extranet.twenga.com">
        <property name="servers" value="www46"/>
        <property name="commondir" value="/home/httpd/twenga-common"/>
        <property name="config_file" value="config_prod.php"/>
        <call target="content"/>
    </env>
    <env name="prod47" mailto="devaa@twenga.com, qateam@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/extranet.twenga.com">
        <property name="servers" value="www47"/>
        <property name="commondir" value="/home/httpd/twenga-common"/>
        <property name="config_file" value="config_prod.php"/>
        <call target="content"/>
    </env>
    <env name="prod" mailto="devaa@twenga.com, qateam@twenga.com, devrts@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/extranet.twenga.com">
        <property name="servers" value="${SERVER_EXTRANET}"/>
        <property name="commondir" value="/home/httpd/twenga-common"/>
        <property name="config_file" value="config_prod.php"/>
        <call target="content"/>
    </env>
    <target name="content">
        <externalproperty name="ref" description="Branch or tag to deploy"/>
        <externalproperty name="ref_common" description="Ref. php-common"/>
        <gitexport repository="git@git.twenga.com:rts/rts.git" ref="${REF}" destdir="${TMPDIR}"/>
        <gitexport repository="git@git.twenga.com:fwt/fwt.git" ref="rts" destdir="${TMPDIR}/fwt"/>
        <gitexport repository="git@git.twenga.com:php-common/php-common.git" ref="${REF_COMMON}" destdir="${TMPDIR}/Twenga" exclude="/build.xml/CHANGELOG/dependancies.ini/phpunit.xml.dist/Tests"/>
        <mkdir destdir="${TMPDIR}/cache/smarty/cache" mode="777"/>
        <mkdir destdir="${TMPDIR}/cache/smarty/templates_c" mode="777"/>
        <rename src="${TMPDIR}/inc/${config_file}" dest="${TMPDIR}/inc/config.php"/>
        <rename src="${TMPDIR}/fwt/${config_file}" dest="${TMPDIR}/fwt/config.php"/>
        <buildlanguage project="rts" destdir="${TMPDIR}/languages"/>
        <sync src="${TMPDIR}/" destdir="${SERVERS}:${BASEDIR}"/>
        <cvsexport repository=":extssh:gaubry@fs1.twenga.com:/home/cvsroot" module="twengaweb/common" destdir="${SERVERS}:${COMMONDIR}"/>
    </target>
</project>