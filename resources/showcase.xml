<?xml version="1.0" encoding="UTF-8"?>
<project name="showcase">
    <env name="prod" mailto="devaa@twenga.com, boc@twenga.com, herve.gouchet@twenga.com, fabien.bernard@twenga.com, julien.lefevre@twenga.com, qateam@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd/showcase">
        <property name="servers" value="${SERVER_PHPWEB_ALL}"/>
        <call target="content_sc"/>
    </env>
    <env name="qa" mailto="devaa@twenga.com, boc@twenga.com, herve.gouchet@twenga.com, fabien.bernard@twenga.com, julien.lefevre@twenga.com, qateam@twenga.com" withsymlinks="true" loadtwengaservers="true" basedir="/home/httpd-qa/showcase">
        <property name="servers" value="www-05"/>
        <call target="content_sc"/>
    </env>
    <target name="content_sc">
        <externalproperty name="ref" description="Branch or tag to deploy"/>
        <externalproperty name="ref_common" description="Ref. php-common"/>
        <externalproperty name="web_common" description="Ref. web-common"/>
        <gitexport repository="git@git.twenga.com:b2c/showcase.git" ref="${REF}" destdir="${TMPDIR}"/>
        <gitexport repository="git@git.twenga.com:php-common/php-common.git" ref="${REF_COMMON}" destdir="${TMPDIR}/Twenga" exclude="/build.xml/CHANGELOG/dependancies.ini/phpunit.xml.dist/Tests"/>
        <gitexport repository="git@git.twenga.com:b2c/common.git" ref="${WEB_COMMON}" destdir="${TMPDIR}/web-common" exclude="/build.xml/CHANGELOG/dependancies.ini/phpunit.xml.dist/Tests"/>
        <rename src="${TMPDIR}/conf/config.inc" dest="${TMPDIR}/conf/config.php"/>
        <mkdir destdir="${TMPDIR}/cache/cmt" mode="777"/>
        <mkdir destdir="${TMPDIR}/cache/smarty" mode="777"/>
        <mkdir destdir="${SERVERS}:${BASEDIR}/smarty/templates_c" mode="777"/>
        <filltemplate srcfile="${TMPDIR}/conf/deploy_config-template.inc.php" destfile="${TMPDIR}/conf/deploy_config.inc.php"/>
        <buildlanguage project="website" destdir="${TMPDIR}/languages"/>
        <sync src="${TMPDIR}/" destdir="${SERVERS}:${BASEDIR}" exclude=""/>
    </target>
</project>